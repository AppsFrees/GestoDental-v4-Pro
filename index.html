<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestoDental v4.0 Pro - Sistema Integral Odontol√≥gico</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #208797;
            --primary-dark: #1a6f7f;
            --accent: #e8634a;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --gray-50: #fafbfc;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-700: #495057;
            --gray-800: #212529;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1600px;
            width: 100%;
            height: 95vh;
            display: none;
        }

        .container.active {
            display: flex;
            flex-direction: column;
        }

        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            left: 0;
            top: 0;
            height: 100%;
            overflow-y: auto;
            z-index: 100;
        }

        .logo {
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #f0f0f0;
        }

        .logo h2 {
            color: #667eea;
            margin: 0;
            font-size: 24px;
        }

        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background: #f8f9fa;
            border-left-color: #667eea;
        }

        .menu-item.active {
            background: #f0f4ff;
            border-left-color: #667eea;
            color: #667eea;
        }

        .content {
            margin-left: 250px;
            padding: 30px;
            min-height: 100vh;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
            width: auto;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .odontograma {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .tooth {
            aspect-ratio: 1;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .tooth:hover {
            border-color: #667eea;
            transform: scale(1.05);
        }

        .tooth.healthy {
            background: #d4edda;
            border-color: #28a745;
        }

        .tooth.caries {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .tooth.ausente {
            background: #d6d8db;
            border-color: #6c757d;
            opacity: 0.5;
        }

        .tooth.tratamiento {
            background: #fff3cd;
            border-color: #ffc107;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .odontograma {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Contenedor de Autenticaci√≥n -->
    <div class="auth-container" id="authContainer">
        <div class="container">
            <h1 style="text-align: center; color: #667eea; margin-bottom: 30px;">ü¶∑ GestoDental Pro</h1>
            <div class="form-group">
                <label>Usuario</label>
                <input type="text" id="loginUsername" placeholder="Ingrese su usuario">
            </div>
            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="loginPassword" placeholder="Ingrese su contrase√±a">
            </div>
            <button class="btn btn-primary" onclick="login()">Iniciar Sesi√≥n</button>
        </div>
    </div>

    <!-- Barra Lateral -->
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <h2>ü¶∑ GestoDental</h2>
        </div>
        <div class="menu-item active" onclick="showSection('dashboard')">
            <span>üìä</span> Dashboard
        </div>
        <div class="menu-item" onclick="showSection('pacientes')">
            <span>üë•</span> Pacientes
        </div>
        <div class="menu-item" onclick="showSection('citas')">
            <span>üìÖ</span> Citas
        </div>
        <div class="menu-item" onclick="showSection('tratamientos')">
            <span>ü¶∑</span> Tratamientos
        </div>
        <div class="menu-item" onclick="showSection('presupuestos')">
            <span>üí∞</span> Presupuestos
        </div>
        <div class="menu-item" onclick="showSection('facturacion')">
            <span>üßæ</span> Facturaci√≥n
        </div>
        <div class="menu-item" onclick="showSection('historial')">
            <span>üìã</span> Historial Cl√≠nico
        </div>
        <div class="menu-item" onclick="showSection('inventario')">
            <span>üì¶</span> Inventario
        </div>
        <div class="menu-item" onclick="showSection('personal')">
            <span>üë®‚Äç‚öïÔ∏è</span> Personal
        </div>
        <div class="menu-item" onclick="showSection('marketing')">
            <span>üì¢</span> Marketing
        </div>
        <div class="menu-item" onclick="logout()">
            <span>üö™</span> Cerrar Sesi√≥n
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="content" id="mainContent">
        <!-- Dashboard -->
        <div id="dashboardSection">
            <div class="header">
                <h2>Dashboard</h2>
                <span id="currentDate"></span>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Pacientes Totales</h3>
                    <div class="value" id="totalPacientes">0</div>
                </div>
                <div class="stat-card">
                    <h3>Citas Hoy</h3>
                    <div class="value" id="citasHoy">0</div>
                </div>
                <div class="stat-card">
                    <h3>Tratamientos Activos</h3>
                    <div class="value" id="tratamientosActivos">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ingresos del Mes</h3>
                    <div class="value" id="ingresosMes">$0</div>
                </div>
            </div>

            <div class="card">
                <h3>Citas de Hoy</h3>
                <div id="citasHoyTable"></div>
            </div>
        </div>

        <!-- Pacientes Section -->
        <div id="pacientesSection" style="display: none;">
            <div class="header">
                <h2>Gesti√≥n de Pacientes</h2>
                <button class="btn btn-primary btn-small" onclick="showAddPacienteForm()">+ Nuevo Paciente</button>
            </div>
            <div class="card">
                <div id="pacientesTable"></div>
            </div>
        </div>

        <!-- Citas Section -->
        <div id="citasSection" style="display: none;">
            <div class="header">
                <h2>Gesti√≥n de Citas</h2>
                <button class="btn btn-primary btn-small" onclick="showAddCitaForm()">+ Nueva Cita</button>
            </div>
            <div class="card">
                <div id="citasTable"></div>
            </div>
        </div>

        <!-- Tratamientos Section -->
        <div id="tratamientosSection" style="display: none;">
            <div class="header">
                <h2>Gesti√≥n de Tratamientos</h2>
            </div>
            <div class="card">
                <div id="tratamientosTable"></div>
            </div>
        </div>

        <!-- Presupuestos Section -->
        <div id="presupuestosSection" style="display: none;">
            <div class="header">
                <h2>Presupuestos</h2>
                <button class="btn btn-primary btn-small" onclick="showAddPresupuestoForm()">+ Nuevo Presupuesto</button>
            </div>
            <div class="card">
                <div id="presupuestosTable"></div>
            </div>
        </div>

        <!-- Facturaci√≥n Section -->
        <div id="facturacionSection" style="display: none;">
            <div class="header">
                <h2>Facturaci√≥n</h2>
                <button class="btn btn-primary btn-small" onclick="showAddFacturaForm()">+ Nueva Factura</button>
            </div>
            <div class="card">
                <div id="facturasTable"></div>
            </div>
        </div>

        <!-- Historial Cl√≠nico Section -->
        <div id="historialSection" style="display: none;">
            <div class="header">
                <h2>Historial Cl√≠nico</h2>
            </div>
            <div class="card">
                <h3>Odontograma</h3>
                <div class="odontograma" id="odontograma"></div>
            </div>
        </div>

        <!-- Inventario Section -->
        <div id="inventarioSection" style="display: none;">
            <div class="header">
                <h2>Inventario</h2>
                <button class="btn btn-primary btn-small" onclick="showAddInventarioForm()">+ Nuevo Item</button>
            </div>
            <div class="card">
                <div id="inventarioTable"></div>
            </div>
        </div>

        <!-- Personal Section -->
        <div id="personalSection" style="display: none;">
            <div class="header">
                <h2>Personal</h2>
                <button class="btn btn-primary btn-small" onclick="showAddPersonalForm()">+ Nuevo Empleado</button>
            </div>
            <div class="card">
                <div id="personalTable"></div>
            </div>
        </div>

        <!-- Marketing Section -->
        <div id="marketingSection" style="display: none;">
            <div class="header">
                <h2>Marketing</h2>
            </div>
            <div class="card">
                <h3>Campa√±as Activas</h3>
                <div id="campanasTable"></div>
            </div>
        </div>
    </div>

    <script>
        // Datos Globales
        let pacientes = [];
        let citas = [];
        let tratamientos = [];
        let presupuestos = [];
        let facturas = [];
        let inventario = [];
        let personal = [];
        let odontogramaData = {};

        // Inicializaci√≥n
        window.onload = function() {
            // Cargar datos del localStorage
            cargarDatos();
            // Inicializar fecha
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('es-ES');
        };

        // Funciones de Autenticaci√≥n
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (username === 'admin' && password === 'admin123') {
                document.getElementById('authContainer').classList.add('active');
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('sidebar').style.display = 'block';
                updateDashboard();
            } else {
                alert('¬°Credenciales incorrectas!');
            }
        }

        function logout() {
            document.getElementById('authContainer').classList.remove('active');
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('sidebar').style.display = 'none';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Navegaci√≥n entre Secciones
        function showSection(section) {
            // Ocultar todas las secciones
            const sections = ['dashboard', 'pacientes', 'citas', 'tratamientos', 'presupuestos', 'facturacion', 'historial', 'inventario', 'personal', 'marketing'];
            sections.forEach(s => {
                const element = document.getElementById(s + 'Section');
                if (element) element.style.display = 'none';
            });

            // Mostrar secci√≥n seleccionada
            const targetSection = document.getElementById(section + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // Actualizar men√∫ activo
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.menu-item').classList.add('active');

            // Cargar datos de la secci√≥n
            if (section === 'pacientes') renderPacientesTable();
            else if (section === 'citas') renderCitasTable();
            else if (section === 'tratamientos') renderTratamientosTable();
            else if (section === 'presupuestos') renderPresupuestosTable();
            else if (section === 'facturacion') renderFacturasTable();
            else if (section === 'historial') renderOdontograma();
            else if (section === 'inventario') renderInventarioTable();
            else if (section === 'personal') renderPersonalTable();
            else if (section === 'marketing') renderCampanasTable();
        }

        // Gesti√≥n de Datos
        function cargarDatos() {
            pacientes = JSON.parse(localStorage.getItem('pacientes') || '[]');
            citas = JSON.parse(localStorage.getItem('citas') || '[]');
            tratamientos = JSON.parse(localStorage.getItem('tratamientos') || '[]');
            presupuestos = JSON.parse(localStorage.getItem('presupuestos') || '[]');
            facturas = JSON.parse(localStorage.getItem('facturas') || '[]');
            inventario = JSON.parse(localStorage.getItem('inventario') || '[]');
            personal = JSON.parse(localStorage.getItem('personal') || '[]');
            odontogramaData = JSON.parse(localStorage.getItem('odontograma') || '{}');
        }

        function guardarDatos() {
            localStorage.setItem('pacientes', JSON.stringify(pacientes));
            localStorage.setItem('citas', JSON.stringify(citas));
            localStorage.setItem('tratamientos', JSON.stringify(tratamientos));
            localStorage.setItem('presupuestos', JSON.stringify(presupuestos));
            localStorage.setItem('facturas', JSON.stringify(facturas));
            localStorage.setItem('inventario', JSON.stringify(inventario));
            localStorage.setItem('personal', JSON.stringify(personal));
            localStorage.setItem('odontograma', JSON.stringify(odontogramaData));
        }

        // Dashboard
        function updateDashboard() {
            document.getElementById('totalPacientes').textContent = pacientes.length;
            const hoy = new Date().toISOString().split('T')[0];
            const citasHoyCount = citas.filter(c => c.fecha === hoy).length;
            document.getElementById('citasHoy').textContent = citasHoyCount;
            document.getElementById('tratamientosActivos').textContent = tratamientos.filter(t => t.estado === 'activo').length;
            
            // Calcular ingresos del mes
            const mesActual = new Date().getMonth();
            const ingresos = facturas.filter(f => {
                const fechaFactura = new Date(f.fecha);
                return fechaFactura.getMonth() === mesActual;
            }).reduce((sum, f) => sum + parseFloat(f.monto || 0), 0);
            document.getElementById('ingresosMes').textContent = '$' + ingresos.toFixed(2);
        }

        // Render Functions
        function renderPacientesTable() {
            const table = document.getElementById('pacientesTable');
            if (!table) return;
            
            if (pacientes.length === 0) {
                table.innerHTML = '<p>No hay pacientes registrados.</p>';
                return;
            }
            
            let html = '<table><thead><tr><th>ID</th><th>Nombre</th><th>Tel√©fono</th><th>Email</th><th>Acciones</th></tr></thead><tbody>';
            pacientes.forEach(p => {
                html += `<tr><td>${p.id}</td><td>${p.nombre}</td><td>${p.telefono || ''}</td><td>${p.email || ''}</td><td><button class="btn btn-info btn-small" onclick="editPaciente(${p.id})">Editar</button></td></tr>`;
            });
            html += '</tbody></table>';
            table.innerHTML = html;
        }

        function renderCitasTable() {
            const table = document.getElementById('citasTable');
            if (!table) return;
            
            if (citas.length === 0) {
                table.innerHTML = '<p>No hay citas registradas.</p>';
                return;
            }
            
            let html = '<table><thead><tr><th>Fecha</th><th>Hora</th><th>Paciente</th><th>Tratamiento</th><th>Acciones</th></tr></thead><tbody>';
            citas.forEach(c => {
                const paciente = pacientes.find(p => p.id === c.pacienteId);
                html += `<tr><td>${c.fecha}</td><td>${c.hora}</td><td>${paciente ? paciente.nombre : 'N/A'}</td><td>${c.tratamiento || ''}</td><td><button class="btn btn-danger btn-small" onclick="deleteCita(${c.id})">Eliminar</button></td></tr>`;
            });
            html += '</tbody></table>';
            table.innerHTML = html;
        }

        // More Render Functions
        function renderTratamientosTable() {
            const table = document.getElementById('tratamientosTable');
            if (!table) return;
            table.innerHTML = '<p>Tratamientos: ' + tratamientos.length + '</p>';
        }

        function renderPresupuestosTable() {
            const table = document.getElementById('presupuestosTable');
            if (!table) return;
            table.innerHTML = '<p>Presupuestos: ' + presupuestos.length + '</p>';
        }

        function renderFacturasTable() {
            const table = document.getElementById('facturasTable');
            if (!table) return;
            table.innerHTML = '<p>Facturas: ' + facturas.length + '</p>';
        }

        function renderInventarioTable() {
            const table = document.getElementById('inventarioTable');
            if (!table) return;
            table.innerHTML = '<p>Items en inventario: ' + inventario.length + '</p>';
        }

        function renderPersonalTable() {
            const table = document.getElementById('personalTable');
            if (!table) return;
            table.innerHTML = '<p>Personal: ' + personal.length + '</p>';
        }

        function renderCampanasTable() {
            const table = document.getElementById('campanasTable');
            if (!table) return;
            table.innerHTML = '<p>Campa√±as de marketing pr√≥ximamente.</p>';
        }

        // Odontograma (FIXED)
        function renderOdontograma() {
            const container = document.getElementById('odontograma');
            if (!container) return;
            
            container.innerHTML = '';
            // Generar 32 dientes
            for (let i = 1; i <= 32; i++) {
                const tooth = document.createElement('div');
                tooth.className = 'tooth';
                tooth.textContent = i;
                tooth.dataset.toothId = i;
                
                // Aplicar estado guardado
                if (odontogramaData[i]) {
                    tooth.classList.add(odontogramaData[i]);
                }
                
                tooth.onclick = function() {
                    toggleTooth(i);
                };
                
                container.appendChild(tooth);
            }
        }

        // FIXED: Corrected tooth selector
        function toggleTooth(toothId) {
            const tooth = document.querySelector('[data-tooth-id="' + toothId + '"]');
            if (!tooth) return;
            
            // Ciclo de estados: healthy -> caries -> tratamiento -> ausente -> healthy
            if (tooth.classList.contains('healthy')) {
                tooth.classList.remove('healthy');
                tooth.classList.add('caries');
                odontogramaData[toothId] = 'caries';
            } else if (tooth.classList.contains('caries')) {
                tooth.classList.remove('caries');
                tooth.classList.add('tratamiento');
                odontogramaData[toothId] = 'tratamiento';
            } else if (tooth.classList.contains('tratamiento')) {
                tooth.classList.remove('tratamiento');
                tooth.classList.add('ausente');
                odontogramaData[toothId] = 'ausente';
            } else {
                tooth.classList.remove('ausente', 'caries', 'tratamiento');
                tooth.classList.add('healthy');
                odontogramaData[toothId] = 'healthy';
            }
            
            guardarDatos();
        }

    // Funciones de Formularios - Implementaci√≥n Funcional
        function showAddPacienteForm() {
            const nombre = prompt('Nombre completo del paciente:');
            if (!nombre) return;
            
            const telefono = prompt('Tel√©fono:');
            const email = prompt('Email:');
            const fechaNacimiento = prompt('Fecha de nacimiento (YYYY-MM-DD):');
            
            const nuevoPaciente = {
                id: Date.now(),
                nombre: nombre,
                telefono: telefono || '',
                email: email || '',
                fechaNacimiento: fechaNacimiento || '',
                fechaRegistro: new Date().toISOString().split('T')[0]
            };
            
            pacientes.push(nuevoPaciente);
            guardarDatos();
            renderPacientesTable();
            updateDashboard();
            alert('¬°Paciente agregado exitosamente!');
        }

        function showAddCitaForm() {
            if (pacientes.length === 0) {
                alert('Primero debe agregar pacientes');
                return;
            }
            
            let listaPacientes = 'Seleccione un paciente por ID:\n\n';
            pacientes.forEach(p => {
                listaPacientes += `ID: ${p.id} - ${p.nombre}\n`;
            });
            
            const pacienteId = parseInt(prompt(listaPacientes + '\nIngrese el ID del paciente:'));
            if (!pacienteId) return;
            
            const paciente = pacientes.find(p => p.id === pacienteId);
            if (!paciente) {
                alert('Paciente no encontrado');
                return;
            }
            
            const fecha = prompt('Fecha de la cita (YYYY-MM-DD):');
            if (!fecha) return;
            
            const hora = prompt('Hora de la cita (HH:MM):');
            if (!hora) return;
            
            const tratamiento = prompt('Tratamiento a realizar:');
            
            const nuevaCita = {
                id: Date.now(),
                pacienteId: pacienteId,
                fecha: fecha,
                hora: hora,
                tratamiento: tratamiento || 'Consulta general',
                estado: 'pendiente'
            };
            
            citas.push(nuevaCita);
            guardarDatos();
            renderCitasTable();
            updateDashboard();
            alert('¬°Cita agendada exitosamente!');
        }

        function showAddPresupuestoForm() {
            if (pacientes.length === 0) {
                alert('Primero debe agregar pacientes');
                return;
            }
            
            let listaPacientes = 'Seleccione un paciente por ID:\n\n';
            pacientes.forEach(p => {
                listaPacientes += `ID: ${p.id} - ${p.nombre}\n`;
            });
            
            const pacienteId = parseInt(prompt(listaPacientes + '\nIngrese el ID del paciente:'));
            if (!pacienteId) return;
            
            const tratamiento = prompt('Tratamiento:');
            if (!tratamiento) return;
            
            const monto = parseFloat(prompt('Monto del presupuesto:'));
            if (!monto || isNaN(monto)) return;
            
            const nuevoPresupuesto = {
                id: Date.now(),
                pacienteId: pacienteId,
                tratamiento: tratamiento,
                monto: monto,
                fecha: new Date().toISOString().split('T')[0],
                estado: 'pendiente'
            };
            
            presupuestos.push(nuevoPresupuesto);
            guardarDatos();
            renderPresupuestosTable();
            alert('¬°Presupuesto creado exitosamente!');
        }

        function showAddFacturaForm() {
            if (pacientes.length === 0) {
                alert('Primero debe agregar pacientes');
                return;
            }
            
            let listaPacientes = 'Seleccione un paciente por ID:\n\n';
            pacientes.forEach(p => {
                listaPacientes += `ID: ${p.id} - ${p.nombre}\n`;
            });
            
            const pacienteId = parseInt(prompt(listaPacientes + '\nIngrese el ID del paciente:'));
            if (!pacienteId) return;
            
            const concepto = prompt('Concepto de la factura:');
            if (!concepto) return;
            
            const monto = parseFloat(prompt('Monto:'));
            if (!monto || isNaN(monto)) return;
            
            const nuevaFactura = {
                id: Date.now(),
                pacienteId: pacienteId,
                concepto: concepto,
                monto: monto,
                fecha: new Date().toISOString().split('T')[0],
                pagado: false
            };
            
            facturas.push(nuevaFactura);
            guardarDatos();
            renderFacturasTable();
            updateDashboard();
            alert('¬°Factura generada exitosamente!');
        }

        function showAddInventarioForm() {
            const nombre = prompt('Nombre del producto:');
            if (!nombre) return;
            
            const cantidad = parseInt(prompt('Cantidad:'));
            if (!cantidad || isNaN(cantidad)) return;
            
            const precio = parseFloat(prompt('Precio unitario:'));
            if (!precio || isNaN(precio)) return;
            
            const nuevoItem = {
                id: Date.now(),
                nombre: nombre,
                cantidad: cantidad,
                precio: precio,
                fechaIngreso: new Date().toISOString().split('T')[0]
            };
            
            inventario.push(nuevoItem);
            guardarDatos();
            renderInventarioTable();
            alert('¬°Producto agregado al inventario!');
        }

        function showAddPersonalForm() {
            const nombre = prompt('Nombre del empleado:');
            if (!nombre) return;
            
            const cargo = prompt('Cargo:');
            const telefono = prompt('Tel√©fono:');
            const email = prompt('Email:');
            
            const nuevoEmpleado = {
                id: Date.now(),
                nombre: nombre,
                cargo: cargo || 'No especificado',
                telefono: telefono || '',
                email: email || '',
                fechaContratacion: new Date().toISOString().split('T')[0]
            };
            
            personal.push(nuevoEmpleado);
            guardarDatos();
            renderPersonalTable();
            alert('¬°Empleado agregado exitosamente!');
        }

        function editPaciente(id) {
            const paciente = pacientes.find(p => p.id === id);
            if (!paciente) return;
            
            const nombre = prompt('Nombre:', paciente.nombre);
            if (nombre) paciente.nombre = nombre;
            
            const telefono = prompt('Tel√©fono:', paciente.telefono);
            if (telefono !== null) paciente.telefono = telefono;
            
            const email = prompt('Email:', paciente.email);
            if (email !== null) paciente.email = email;
            
            guardarDatos();
            renderPacientesTable();
            alert('¬°Paciente actualizado!');
        }

        function deleteCita(id) {
            if (confirm('¬øEliminar esta cita?')) {
                citas = citas.filter(c => c.id !== id);
                guardarDatos();
                renderCitasTable();
                updateDashboard();
            }
        }    }
    </script>
</body>
</html>
